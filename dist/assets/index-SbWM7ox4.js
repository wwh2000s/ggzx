import{k as w,d as X,r as c,l as U,a as Y,o as Z,c as ee,j as e,w as a,f as r,m as _,n as m,E as le,F as ae,q as y,s as oe,v as te,x as re,y as ne,z as se,A as ie,B as de,C as ue,D as ce,G as pe,H as me,_ as fe}from"./index-BjaseuBL.js";const _e=(i,s,b)=>w.get(`/admin/acl/role/${i}/${s}/?roleName=${b}`),ge=i=>i.id?w.put("/admin/acl/role/update",i):w.post("/admin/acl/role/save",i),ve=i=>w.get("/admin/acl/permission/toAssign/"+i),ye=(i,s)=>w.post(`/admin/acl/permission/doAssign/?roleId=${i}&permissionId=${s}`),we=i=>w.delete("/admin/acl/role/remove/"+i),Ce=X({__name:"index",setup(i){let s=c(!1),b=c([]),V=c(0),C=c(1),k=c(5),g=c(""),N=c(),E=c();const A={children:"children",label:"name"};let $=U({roleName:[{required:!0,trigger:"blur",validator:(t,l,n)=>{l.trim().length>=2?n():n(new Error("职位名称至少两位"))}}]}),x=c([]),R=c([]),d=U({roleName:""}),p=c(!1);const S=t=>{f(),console.log(`每页数量：${t} `)},T=t=>{f(),console.log(`当前页: ${t}`)},f=async()=>{let t=await _e(C.value,k.value,g.value);t.code==200&&(b.value=t.data.records,V.value=t.data.total)},D=()=>{f(),g.value=""},j=()=>{f()},B=()=>{d.roleName="",p.value=!0},F=t=>{p.value=!0,Object.assign(d,t.row)},H=async()=>{await N.value.validate(),(await ge(d)).code==200?(y({type:"success",message:d.id?"更新成功":"添加成功"}),p.value=!1,f()):y({type:"error",message:d.id?"更新失败":"添加失败"})},z=(t,l)=>(t.forEach(n=>{n.select&&n.level==4&&l.push(n.id),n.children&&n.children.length>0&&z(n.children,l)}),l),M=async t=>{s.value=!0,Object.assign(d,t.row);let l=await ve(d.id);l.code==200&&(x.value=l.data,R.value=z(x.value,[]))},O=async()=>{const t=d.id;let l=E.value.getCheckedKeys(),n=E.value.getHalfCheckedKeys(),h=l.concat(n);(await ye(t,h)).code==200?(y({type:"success",message:"分配职位成功"}),s.value=!1,window.location.reload()):y({type:"error",message:"分配职位失败"})},K=async t=>{let l=await we(t.row.id);l.code==200?(y({type:"success",message:"删除成功"}),f()):y({type:"error",message:"删除失败"}),console.log(l)};return Y(()=>{f()}),(t,l)=>{const n=oe,h=te,u=re,P=ne,q=se,v=ie,L=de,G=ue,J=ce,Q=pe,W=me;return Z(),ee(ae,null,[e(q,null,{default:a(()=>[e(P,{inline:!0,class:"form"},{default:a(()=>[e(h,{label:"职位搜索"},{default:a(()=>[e(n,{modelValue:r(g),"onUpdate:modelValue":l[0]||(l[0]=o=>_(g)?g.value=o:g=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),e(h,null,{default:a(()=>[e(u,{type:"primary",onClick:D},{default:a(()=>[m("搜索")]),_:1}),e(u,{onClick:j},{default:a(()=>[m("重置")]),_:1})]),_:1})]),_:1})]),_:1}),e(q,null,{default:a(()=>[e(u,{type:"primary",icon:"Plus",onClick:B},{default:a(()=>[m("添加职位")]),_:1}),e(G,{border:"",style:{margin:"10px 0"},data:r(b)},{default:a(()=>[e(v,{type:"index",align:"center",width:"80",label:"序号"}),e(v,{label:"ID",align:"center",prop:"id"}),e(v,{label:"职位名称",align:"center",prop:"roleName","show-overflow-tooltip":""}),e(v,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),e(v,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),e(v,{label:"操作",align:"center",width:"280"},{default:a((o,he)=>[e(u,{type:"primary",size:"small",icon:"User",onClick:I=>M(o)},{default:a(()=>[m("分配权限")]),_:2},1032,["onClick"]),e(u,{type:"primary",size:"small",icon:"Edit",onClick:I=>F(o)},{default:a(()=>[m("编辑")]),_:2},1032,["onClick"]),e(L,{title:"是否确认删除?",onConfirm:I=>K(o),width:"200px"},{reference:a(()=>[e(u,{type:"primary",size:"small",icon:"Delete"},{default:a(()=>[m("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),e(J,{"current-page":r(C),"onUpdate:currentPage":l[1]||(l[1]=o=>_(C)?C.value=o:C=o),"page-size":r(k),"onUpdate:pageSize":l[2]||(l[2]=o=>_(k)?k.value=o:k=o),background:"","page-sizes":[5,10,15],layout:" prev, pager, next, jumper,->, sizes,total",total:r(V),onSizeChange:S,onCurrentChange:T},null,8,["current-page","page-size","total"])]),_:1}),e(Q,{modelValue:r(p),"onUpdate:modelValue":l[5]||(l[5]=o=>_(p)?p.value=o:p=o),title:r(d).id?"更新职位":"添加职位",width:"500"},{footer:a(()=>[e(u,{onClick:l[4]||(l[4]=o=>_(p)?p.value=!1:p=!1)},{default:a(()=>[m("取消")]),_:1}),e(u,{type:"primary",onClick:H},{default:a(()=>[m("保存")]),_:1})]),default:a(()=>[e(P,{model:r(d),rules:r($),ref_key:"formRef",ref:N},{default:a(()=>[e(h,{label:"职位名称",prop:"roleName"},{default:a(()=>[e(n,{modelValue:r(d).roleName,"onUpdate:modelValue":l[3]||(l[3]=o=>r(d).roleName=o),placeholder:"请输入职位名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),e(W,{modelValue:r(s),"onUpdate:modelValue":l[7]||(l[7]=o=>_(s)?s.value=o:s=o),title:"分配权限"},{default:a(()=>[e(r(le),{ref_key:"tree",ref:E,data:r(x),"show-checkbox":"","default-expand-all":"","default-checked-keys":r(R),props:A,"node-key":"id","highlight-current":""},null,8,["data","default-checked-keys"])]),footer:a(()=>[e(u,{onClick:l[6]||(l[6]=o=>_(s)?s.value=!1:s=!1)},{default:a(()=>[m("取消")]),_:1}),e(u,{type:"primary",onClick:O},{default:a(()=>[m("保存")]),_:1})]),_:1},8,["modelValue"])],64)}}}),Ee=fe(Ce,[["__scopeId","data-v-f5a17ad0"]]);export{Ee as default};
